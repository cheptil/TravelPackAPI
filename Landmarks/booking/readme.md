# Анализ Booking.com Cities API

## Основная информация
- **Endpoint**: POST https://demandapi.booking.com/3.1/common/locations/cities
- **Тип**: Pilot API (ранний доступ, ограниченный доступ)
- **Статус**: В разработке, планируется общая доступность в Q2 2025

## Заголовки запроса
- **Authorization**: Bearer <YOUR_string_HERE>
- **Content-Type**: application/json
- **X-Affiliate-Id**: integer (обязательный) - идентификатор партнера

## Параметры тела запроса (JSON)
- **airport**: string (опционально) - трехбуквенный код аэропорта IATA
- **city**: integer (опционально) - уникальный идентификатор города
- **country**: string (опционально) - двухбуквенный код страны ISO 3166-1 alpha-2
- **district**: integer (опционально) - идентификатор района
- **landmark**: integer (опционально) - идентификатор достопримечательности
- **languages**: Array of strings (опционально) - языки ответа, по умолчанию ["en-gb"]
- **page**: string (опционально) - токен пагинации
- **region**: integer (опционально) - идентификатор региона
- **rows**: integer (опционально) - количество результатов (10-1000), по умолчанию 100

## Пример curl запроса
```bash
curl -i -X POST \
  https://demandapi.booking.com/3.1/common/locations/cities \
  -H 'Authorization: Bearer <YOUR_string_HERE>' \
  -H 'Content-Type: application/json' \
  -H 'X-Affiliate-Id: 0' \
  -d '{
    "country": "nl",
    "languages": [
      "en-gb",
      "zh-cn"
    ]
  }'
```

## Структура ответа (200 OK)
- **request_id**: string - уникальный идентификатор запроса
- **data**: Array of objects (CityOutput) - массив городов
- **next_page**: string or null - токен для следующей страницы результатов


## Структура объекта CityOutput
Каждый город в массиве `data` содержит следующие поля:

- **id**: integer - уникальный идентификатор города
- **name**: object (TranslatedString) - название города на разных языках
- **coordinates**: object (Coordinates) - географические координаты
  - **latitude**: number (double) - широта
  - **longitude**: number (double) - долгота

## Пример ответа
```json
{
  "request_id": "01ff9ez700exycp98w90w5r9sh",
  "data": [
    {
      "id": 123,
      "name": {
        "en-gb": "Amsterdam",
        "zh-cn": "阿姆斯特丹"
      },
      "coordinates": {
        "latitude": 52.3676,
        "longitude": 4.9041
      }
    }
  ],
  "next_page": "..."
}
```

## Особенности API
1. **Pilot статус**: API находится в стадии раннего доступа
2. **Ограниченный доступ**: только для избранных партнеров Type 2 и Type 4
3. **Аутентификация**: требуется Bearer token и X-Affiliate-Id
4. **Пагинация**: поддерживается через параметр `page` и поле `next_page`
5. **Мультиязычность**: поддержка нескольких языков в ответе
6. **Фильтрация**: возможность фильтрации по стране, региону, аэропорту и другим параметрам



# Результаты тестирования API

## Выполненные тесты

### Тест 1: Запрос городов Нидерландов
- **URL**: https://demandapi.booking.com/3.1/common/locations/cities
- **Метод**: POST
- **Параметры**: 
  - country: "nl"
  - languages: ["en-gb", "ru"]
  - rows: 5
- **Результат**: HTTP 401 Unauthorized
- **Заголовки ответа**: Включают CloudFront и security headers

### Тест 2: Общий запрос городов
- **Параметры**: 
  - languages: ["en-gb"]
  - rows: 3
- **Результат**: HTTP 401 Unauthorized

## Анализ результатов

### Положительные моменты
1. **API доступен**: Сервер отвечает на запросы (не 404 или 500)
2. **Правильная структура**: Запросы формируются корректно согласно документации
3. **Безопасность**: API правильно блокирует неавторизованные запросы
4. **Инфраструктура**: Использует CloudFront CDN для производительности

### Ограничения
1. **Pilot статус**: API находится в стадии раннего доступа
2. **Ограниченный доступ**: Только для избранных партнеров Type 2 и Type 4
3. **Аутентификация**: Требуется валидный Bearer token
4. **Партнерский ID**: Необходим корректный X-Affiliate-Id

## Выводы и рекомендации

### Для получения доступа к API:
1. **Подача заявки**: Обратиться к команде Partnerships Booking.com
2. **Статус партнера**: Получить статус Type 2 или Type 4 партнера
3. **Pilot программа**: Участвовать в программе раннего доступа
4. **Документация**: Получить актуальные credentials и документацию

### Техническая готовность:
1. **Структура запросов**: ✅ Корректно реализована
2. **Обработка ошибок**: ✅ Предусмотрена
3. **Форматы данных**: ✅ JSON корректно обрабатывается
4. **HTTP клиент**: ✅ Настроен правильно

### Следующие шаги:
1. Получить доступ к pilot программе
2. Получить валидные credentials
3. Протестировать с реальными данными
4. Реализовать обработку пагинации
5. Добавить кэширование результатов

## Практическое применение

API может быть использован для:
- Получения списка городов по странам
- Поиска городов по координатам
- Интеграции с системами бронирования
- Создания географических справочников
- Локализации названий городов

## Технические детали реализации

### Обязательные заголовки:
```
Authorization: Bearer <valid_token>
Content-Type: application/json
X-Affiliate-Id: <partner_id>
```

### Рекомендуемые параметры:
- Всегда указывать `languages` для локализации
- Использовать `rows` для контроля объема данных
- Применять фильтры (`country`, `region`) для оптимизации
- Реализовать пагинацию через `page` параметр

### Обработка ошибок:
- 401: Проверить токен аутентификации
- 403: Проверить права доступа к pilot программе
- 429: Реализовать rate limiting
- 500: Повторить запрос с задержкой

