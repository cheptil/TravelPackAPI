# Анализ API RateHawk (ETG API)

## Основная информация

RateHawk является частью Emerging Travel Group (ETG) и предоставляет API для бронирования отелей по всему миру.

### Ключевые характеристики:
- **Хост API**: https://api.worldota.net
- **Тип аутентификации**: HTTP Basic Authentication
- **Инвентарь**: 2.7M+ отелей в 220+ странах
- **Поставщики**: 320+ поставщиков
- **Языки контента**: 32+ языка

## Аутентификация

### Структура API ключа:
- Формат: `<KEY_ID>:<API_KEY>`
- KEY_ID используется как username для HTTP Basic Auth
- API_KEY используется как password для HTTP Basic Auth

### Типы окружений:
1. **Test environment** - для тестирования
   - Используется только для тестового отеля с `hid` - `8473727` или `id` - `test_hotel_do_not_book`
   - ⚠️ Тестовый отель подразумевает реальные бронирования с финансовыми обязательствами

2. **Production environment** - для продакшена
   - Используется для бронирования реальных отелей
   - Может быть несколько production ключей для разных контрактов

## Лимиты запросов

API имеет ограничения на количество запросов с соответствующими заголовками:
- `X-RateLimit-SecondsNumber` - период в секундах
- `X-RateLimit-RequestsNumber` - максимальное количество запросов за период
- `X-RateLimit-Remaining` - оставшееся количество запросов
- `X-RateLimit-Reset` - время сброса лимита

### Пример лимитов:
```
"X-RateLimit-SecondsNumber": 1
"X-RateLimit-RequestsNumber": 10
"X-RateLimit-Remaining": 9
"X-RateLimit-Reset": "2018-08-14T08:54:11"
```



## B2B API Endpoints

### Основные группы вызовов:
1. **Static content** - статический контент
2. **Hotel search** - поиск отелей
3. **Booking** - бронирование
4. **Post booking** - пост-бронирование
5. **Contracts** - контракты
6. **Documents** - документы
7. **Order groups** - группы заказов
8. **Profiles** - профили

### Hotel Search API

#### Search by geo coordinates
**Endpoint**: `https://api.worldota.net/api/b2b/v3/search/serp/geo/`
**Метод**: POST
**Описание**: Получение тарифов отелей по географическим координатам

**Обязательные параметры запроса**:
- `checkin` (String) - дата заезда
- `checkout` (String) - дата выезда  
- `latitude` (Float) - широта
- `longitude` (Float) - долгота
- `residency` (String) - резидентство

**Опциональные параметры**:
- `currency` (String) - валюта
- `language` (String) - язык
- `timeout` (Float) - таймаут
- `guests` (Array) - гости
- `radius` (Integer) - радиус поиска

**Пример запроса**:
```bash
curl --user '<KEY_ID>:<API_KEY>' 'https://api.worldota.net/api/b2b/v3/search/serp/geo/' \
--header 'Content-Type: application/json' \
--data '{
  "checkin": "2025-10-22",
  "checkout": "2025-10-25",
  "residency": "gb",
  "language": "en",
  "guests": [
    {
      "adults": 2,
      "children": []
    }
  ],
  "longitude": 13.38886,
  "latitude": 52.517036,
  "radius": 150,
  "currency": "EUR"
}'
```

**Важные замечания**:
⚠️ Не рекомендуется позволять пользователям выбирать тарифы из ответа этого вызова
⚠️ Полное совпадение с ответом от запроса "Retrieve hotelpage" не ожидается


## Результаты тестового запроса

### Выполненный запрос
Был выполнен тестовый запрос к endpoint поиска отелей по географическим координатам:
- **URL**: `https://api.worldota.net/api/b2b/v3/search/serp/geo/`
- **Метод**: POST
- **Координаты**: Берлин (52.517036, 13.38886)
- **Даты**: 22-25 октября 2025
- **Гости**: 2 взрослых

### Полученный ответ
```json
{
  "data": null,
  "debug": {
    "request": {
      "checkin": "2025-10-22",
      "checkout": "2025-10-25",
      "residency": "gb",
      "language": "en",
      "guests": [{"adults": 2, "children": []}],
      "longitude": 13.38886,
      "latitude": 52.517036,
      "radius": 150,
      "currency": "EUR"
    },
    "key_id": 0,
    "validation_error": null
  },
  "status": "error",
  "error": "no_auth_header"
}
```

### Анализ ответа

#### Положительные моменты:
✅ **API доступен и работает** - сервер отвечает на запросы
✅ **Endpoint корректный** - URL правильный
✅ **Формат запроса правильный** - JSON корректно обрабатывается
✅ **Валидация работает** - параметры запроса проверены и сохранены
✅ **Отладочная информация** - API предоставляет подробную информацию для отладки

#### Требования для работы:
❌ **Необходима аутентификация** - требуется HTTP Basic Authentication
❌ **Нужен API ключ** - в формате KEY_ID:API_KEY

### Важные заголовки ответа
- `www-authenticate: Basic realm="Restricted"` - подтверждает требование Basic Auth
- `x-partner-application-time: 0.00` - время обработки запроса
- `x-partner-error-slug: no_auth_header` - специфичный код ошибки
- `request-id` - уникальный идентификатор для отладки
- `version: b799663` - версия API

## Возможности API

### Основные функции:
1. **Поиск отелей** по различным критериям:
   - По географическим координатам
   - По региону
   - По ID отелей
   - С сортировкой и фильтрацией

2. **Получение детальной информации**:
   - Страница отеля с подробностями
   - Информация о тарифах
   - Условия питания и отмены

3. **Процесс бронирования**:
   - Предварительное бронирование (prebook)
   - Создание окончательного бронирования
   - Управление существующими бронированиями

4. **Дополнительные возможности**:
   - Получение контрактной информации
   - Документооборот
   - Группировка заказов
   - Управление профилями

### Технические особенности:
- **RESTful API** с JSON форматом
- **HTTP Basic Authentication**
- **Лимиты запросов** с информацией в заголовках
- **Подробная отладочная информация**
- **Мультиязычная поддержка** (32+ языка)
- **Мультивалютность**

### Инвентарь:
- **2.7M+ отелей** по всему миру
- **320+ поставщиков**
- **220 стран и территорий**
- **100+ платформ** для интеграции


## Практические рекомендации

### Для начала работы с API:

1. **Регистрация и получение доступа**:
   - Зарегистрироваться на https://www.ratehawk.com/
   - Заполнить форму партнера
   - Получить API ключ в личном кабинете
   - Ключ имеет формат `KEY_ID:API_KEY`

2. **Настройка аутентификации**:
   ```python
   from requests.auth import HTTPBasicAuth
   auth = HTTPBasicAuth('YOUR_KEY_ID', 'YOUR_API_KEY')
   ```

3. **Тестирование**:
   - Использовать тестовый отель с `hid=8473727`
   - Помнить, что тестовые бронирования имеют финансовые обязательства
   - Проверить лимиты запросов в заголовках ответа

### Типичный workflow:

1. **Поиск отелей**:
   ```
   POST /api/b2b/v3/search/serp/geo/
   POST /api/b2b/v3/search/serp/region/
   ```

2. **Получение деталей**:
   ```
   POST /api/b2b/v3/hotel/info/
   ```

3. **Предварительное бронирование**:
   ```
   POST /api/b2b/v3/hotel/prebook/
   ```

4. **Окончательное бронирование**:
   ```
   POST /api/b2b/v3/hotel/order/booking/form/
   ```

### Обработка ошибок:

API возвращает структурированные ошибки с кодами:
- `no_auth_header` - отсутствует аутентификация
- `invalid_credentials` - неверные учетные данные
- `rate_limit_exceeded` - превышен лимит запросов
- `validation_error` - ошибки валидации параметров

### Мониторинг лимитов:

Следить за заголовками:
- `X-RateLimit-RequestsNumber` - максимум запросов
- `X-RateLimit-Remaining` - оставшиеся запросы
- `X-RateLimit-Reset` - время сброса лимита

## Заключение

RateHawk API представляет собой мощный инструмент для интеграции с системой бронирования отелей. API хорошо документирован, имеет понятную структуру и предоставляет подробную отладочную информацию.

### Ключевые преимущества:
- Обширный инвентарь (2.7M+ отелей)
- Множество поставщиков (320+)
- Глобальное покрытие (220 стран)
- Техническая поддержка на 50+ языках
- Быстрое время ответа
- Конкурентные тарифы

### Требования для интеграции:
- Регистрация и получение API ключа
- Реализация HTTP Basic Authentication
- Соблюдение лимитов запросов
- Правильная обработка ошибок

Тестовый запрос показал, что API работает корректно и готов к использованию при наличии соответствующих учетных данных.

