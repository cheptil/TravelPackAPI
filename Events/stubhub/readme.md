# Полный анализ StubHub API

## Обзор

StubHub API представляет собой RESTful API для интеграции с крупнейшим в мире маркетплейсом билетов. API предоставляет возможности для поиска событий, просмотра билетов, покупки и продажи билетов на различные мероприятия.

## Результаты изучения документации

### Основные характеристики API

**Технические параметры:**
- **Протокол**: HTTPS
- **Базовый домен**: `api.stubhub.net` (продакшн), `sandbox.api.stubhub.net` (тестирование)
- **Формат данных**: `application/hal+json` (JSON с гиперссылками)
- **Аутентификация**: OAuth 2.0
- **CORS**: Поддерживается для клиентских приложений

**Доступные окружения:**
1. **Sandbox (тестовое)**:
   - API: `https://sandbox.api.stubhub.net/`
   - OAuth: `https://sandbox.account.stubhub.com/oauth2/token`
   
2. **Production (продакшн)**:
   - API: `https://api.stubhub.net/`
   - OAuth: `https://account.stubhub.com/oauth2/token`

### Процесс аутентификации

StubHub API использует OAuth 2.0 с двумя основными потоками:

#### Application-Only Authentication Flow
Используется для доступа к публичным данным без участия пользователя.

**Шаги аутентификации:**

1. **Создание Basic Authorization header**:
   - URL-кодировать `client_id` и `client_secret` согласно RFC 1738
   - Объединить через двоеточие: `client_id:client_secret`
   - Закодировать в Base64

2. **Получение access token**:
   ```http
   POST https://sandbox.account.stubhub.com/oauth2/token
   Authorization: Basic {encoded_credentials}
   Content-Type: application/x-www-form-urlencoded
   
   grant_type=client_credentials&scope=read:events
   ```

**Пример ответа:**
```json
{
  "access_token": "pYXQiOjE0MjI1MzY0NjEsInNb3BIjo",
  "token_type": "bearer",
  "expires_in": 86400,
  "scope": "read:events"
}
```

#### User-Login Authentication Flow
Используется для операций, требующих авторизации пользователя (покупка, продажа билетов).

### Доступные API эндпоинты

#### Catalog API (v1.0.0.75)

**События (Events):**
- `GET /catalog/events` - Список всех событий
- `PUT /catalog/events` - Получение событий по ID
- `GET /catalog/events/search` - Поиск событий
- `GET /catalog/events/{id}` - Получение конкретного события
- `GET /catalog/events/category/{categoryId}` - События по категории

**Категории (Categories):**
- `GET /catalog/categories/map` - Поиск категорий

**Площадки (Venues):**
- `GET /catalog/venues` - Список площадок

#### Inventory API (v2.249.0.0)
- Управление листингами продавца
- Обновление листингов
- Поиск в инвентаре

### Параметры поиска событий

Эндпоинт `/catalog/events/search` поддерживает следующие параметры:

- `q` (string) - Текст запроса для поиска событий
- `dateLocal` (string) - Конкретная дата события
- `page` (integer) - Номер страницы результатов
- `page_size` (integer) - Размер страницы
- `updated_since` (datetime) - Фильтр по времени обновления
- `sort` (string) - Сортировка результатов
- `country_code` (string) - Фильтр по стране
- `latitude`, `longitude`, `max_distance_in_meters` - Геолокационный поиск
- `genre_id` (integer) - Фильтр по жанру
- `exclude_parking_passes` (boolean) - Исключить парковочные пропуска

## Результаты тестирования API

### Методология тестирования

Было проведено тестирование основных эндпоинтов StubHub API без аутентификации для:
1. Проверки доступности эндпоинтов
2. Анализа структуры ошибок
3. Понимания требований к аутентификации

### Результаты тестовых запросов

#### Тестирование основных эндпоинтов

| Эндпоинт | HTTP Статус | Результат |
|----------|-------------|-----------|
| `/catalog/events` | 401 | ✓ Существует, требует аутентификации |
| `/catalog/events/search` | 401 | ✓ Существует, требует аутентификации |
| `/catalog/categories/map` | 401 | ✓ Существует, требует аутентификации |
| `/catalog/venues` | 401 | ✓ Существует, требует аутентификации |

#### Тестирование OAuth endpoint

**Запрос:**
```http
POST https://sandbox.account.stubhub.com/oauth2/token
Authorization: Basic dGVzdF9jbGllbnRfaWQ6dGVzdF9jbGllbnRfc2VjcmV0
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials&scope=read:events
```

**Результат:** HTTP 401 - Неверные credentials (ожидаемо для тестовых данных)

#### Тестирование поиска с параметрами

Все запросы к `/catalog/events/search` с различными параметрами (`q=concert`, `q=football`, `q=basketball`) возвращали статус 401, подтверждая необходимость аутентификации.

### Анализ структуры ответов

**Формат ошибок:**
- API возвращает HTML-страницы ошибок вместо JSON при отсутствии аутентификации
- Статус 401 Unauthorized возвращается для всех защищенных эндпоинтов
- Статус 404 Not Found возвращается для несуществующих эндпоинтов

## Практические примеры использования

### Создание листинга билетов

API предоставляет эндпоинт для создания листингов через "Create Listings for Requested Events":

```json
{
  "ExternalId": "Your_Arbitrary_Id",
  "Seating": {
    "Section": "101",
    "Row": "A",
    "SeatFrom": "3",
    "SeatTo": "5"
  },
  "TicketPrice": {
    "Amount": 150,
    "Currency": "USD"
  },
  "FaceValue": {
    "Amount": 200,
    "Currency": "USD"
  },
  "TicketType": "ETicket",
  "NumberOfTickets": 4,
  "Event": {
    "Name": "Dreams Come True",
    "Startdate": "2025-11-28T15:30:00",
    "Venue": {
      "Name": "Osaka Jo Hall",
      "City": "Osaka",
      "Country": "JP"
    }
  }
}
```

### Поиск событий

После получения access token, поиск событий выполняется следующим образом:

```http
GET https://sandbox.api.stubhub.net/catalog/events/search?q=concert&page=1&page_size=10
Authorization: Bearer {access_token}
Accept: application/hal+json
```

## Выводы и рекомендации

### Ключевые выводы

1. **Строгая аутентификация**: Все основные эндпоинты API требуют OAuth 2.0 аутентификации
2. **Хорошо структурированная документация**: API имеет подробную документацию с примерами
3. **RESTful дизайн**: API следует принципам REST с логичной структурой эндпоинтов
4. **Поддержка HAL+JSON**: Использование гипермедиа для навигации по API
5. **Разделение окружений**: Четкое разделение между sandbox и production

### Рекомендации для разработчиков

1. **Получение credentials**: Необходимо зарегистрироваться в StubHub Developer Portal для получения `client_id` и `client_secret`

2. **Начало работы с sandbox**: Всегда начинать разработку с тестового окружения

3. **Обработка токенов**: Реализовать автоматическое обновление access token (срок действия 24 часа)

4. **Обработка ошибок**: Предусмотреть обработку различных HTTP статусов (401, 403, 404, 500)

5. **Соблюдение лимитов**: Изучить и соблюдать rate limits API

### Потенциальные сценарии использования

1. **Поиск событий**: Интеграция поиска билетов в мобильные приложения
2. **Сравнение цен**: Создание сервисов сравнения цен на билеты
3. **Автоматизация продаж**: Автоматическое размещение билетов на продажу
4. **Аналитика**: Анализ трендов цен и популярности событий
5. **Уведомления**: Системы уведомлений о появлении билетов на интересующие события

## Ограничения тестирования

1. **Отсутствие реальных credentials**: Тестирование проводилось без валидных API ключей
2. **Ограниченный доступ к данным**: Невозможность получить реальные ответы API
3. **Неполное тестирование функциональности**: Не удалось протестировать полный цикл операций

## Заключение

StubHub API представляет собой мощный и хорошо документированный инструмент для интеграции с платформой продажи билетов. API следует современным стандартам REST и OAuth 2.0, обеспечивая безопасный доступ к функциональности платформы.

Для полноценного использования API необходимо:
1. Получить официальные credentials от StubHub
2. Изучить детальную документацию по конкретным эндпоинтам
3. Реализовать правильную обработку аутентификации и ошибок
4. Протестировать интеграцию в sandbox окружении перед переходом в продакшн

API подходит для широкого спектра приложений - от простого поиска билетов до сложных систем управления инвентарем и аналитики рынка билетов.

