# Исследование Google Maps Places API

## Основная информация

Google Maps Places API предоставляет доступ к данным о местах для более чем 200 миллионов мест по всему миру. API позволяет добавлять детали мест, поиск и автодополнение в приложения.

## Версии API

Places API поддерживает две версии:
1. **Places API** - текущая версия
2. **Places API (New)** - новая версия следующего поколения

## Основные возможности

### Ключевые функции:
- **Place IDs** - уникально идентифицируют место в базе данных Google Places и на Google Maps
- **Text Search (New)** - возвращает информацию о месте на основе текстового ввода (название, адрес, номер телефона)
- **Nearby Search (New)** - поиск мест поблизости
- **Place Details (New)** - получение детальной информации о месте
- **Places Library in Maps JavaScript API** - добавление функций поиска и автодополнения в приложения
- **Place Icons** - запрос и отображение иконок для различных типов мест

### Дополнительные возможности:
- Поиск по маршруту
- AI-powered summaries (сводки на основе ИИ)
- Использование session tokens
- Работа с данными мест

## Настройка

Для начала работы необходимо:
1. Создать аккаунт Google Cloud
2. Сгенерировать API ключ
3. Настроить проект Google Cloud



## Text Search (New) API

### Описание
Text Search (New) возвращает информацию о наборе мест на основе строки запроса. Например: "pizza in New York", "shoe stores near Ottawa" или "123 Main Street".

### Формат запроса
- **Метод**: HTTP POST
- **URL**: `https://places.googleapis.com/v1/places:searchText`
- **Формат данных**: JSON в теле запроса

### Пример запроса (curl)
```bash
curl -X POST -d '{
  "textQuery" : "Spicy Vegetarian Food in Sydney, Australia"
}' \
-H 'Content-Type: application/json' \
-H 'X-Goog-Api-Key: API_KEY' \
-H 'X-Goog-FieldMask: places.displayName,places.formattedAddress,places.priceLevel' \
'https://places.googleapis.com/v1/places:searchText'
```

### Обязательные параметры
1. **FieldMask** - указывает список полей для возврата в ответе
   - Передается через HTTP заголовок `X-Goog-FieldMask`
   - Пример: `places.displayName,places.formattedAddress,places.priceLevel`
   - Использование `*` возвращает все поля (не рекомендуется в продакшене)

2. **textQuery** - текстовый запрос для поиска мест

### Структура ответа
```json
{
  "places": [
    {
      object (Place)
    }
  ]
}
```

### Ограничения
- Максимум 60 результатов на все страницы
- Массив `places` содержит все найденные места
- Каждое место представлено объектом `Place` с детальной информацией

### Типы полей и тарификация
- **Text Search Essentials ID Only SKU**: базовые поля (id, name, attributions)
- **Text Search Pro SKU**: расширенные поля (displayName, formattedAddress, location и др.)
- **Text Search Enterprise SKU**: бизнес-информация (рейтинги, часы работы, контакты)
- **Text Search Enterprise + Atmosphere SKU**: дополнительные атрибуты (allowsDogs и др.)

### Примеры запросов
- "pizza restaurants in New York" - поиск по типу и локации
- "+1 514-670-8700" - поиск по номеру телефона
- "ChainRestaurant New York" - поиск по названию бизнеса
- "123 Main Street, Pleasanton US" - поиск по адресу


## Получение и использование API ключей

### Предварительные требования
- Нужен проект Google Cloud с настроенным биллинговым аккаунтом
- Places API должен быть включен в проекте
- Подробнее: "Set up in Cloud console"

### Создание API ключа

#### Шаги создания:
1. Перейти на страницу **Google Maps Platform > Credentials**
2. На странице Credentials нажать **Create credentials > API key**
3. Появится диалог **API key created** с новым API ключом
4. Нажать **Close**
5. Новый API ключ будет отображен на странице Credentials под разделом **API keys**

**Важно**: Рекомендуется ограничить API ключ перед использованием в продакшене.

### Ограничение API ключей

Google настоятельно рекомендует ограничивать API ключи для безопасности:

#### Шаги ограничения:
1. Перейти на **Google Maps Platform > Credentials**
2. Выбрать API ключ для настройки ограничений
3. В разделе **Key restrictions** установить:

**Application restrictions** (ограничения приложения):
- **IP addresses (web servers, cron jobs, etc.)** - для веб-серверов
- Указать один или несколько IPv4 или IPv6 адресов или подсетей

**API restrictions** (ограничения API):
- Нажать **Restrict key**
- Выбрать **Places API (Legacy)** или **Places API (New)** из выпадающего списка
- Если API не отображается в списке, нужно его включить

4. Нажать **Save** для сохранения изменений

### Добавление API ключа к запросу

API ключ должен быть включен в каждый запрос к Places API.

#### Пример URL с API ключом:
```
https://places.googleapis.com/v1/places/ChIJj61dQgK6j4AR4GeTYWZsKWw?
fields=id,displayName&key=YOUR_API_KEY
```

#### Важные моменты:
- **HTTPS обязателен** для запросов с API ключом
- При использовании Web Services все специальные символы в параметрах должны быть URL-кодированы
- URL ограничены 2048 символами для всех веб-сервисов
- Разные браузеры, прокси и серверы могут иметь разные ограничения на длину URL

### Рекомендации по безопасности
- Создавать отдельный API ключ для каждой версии API (Legacy и New)
- Создавать отдельный API ключ для каждого приложения и платформы
- Следовать лучшим практикам безопасности API


## Результаты тестирования API

### Выполненные тесты

Было проведено тестирование Google Places API (New) с различными типами запросов для анализа поведения API и структуры ответов.

#### 1. Базовый тест Text Search API

**Запрос:**
```bash
POST https://places.googleapis.com/v1/places:searchText
Content-Type: application/json
X-Goog-FieldMask: places.displayName,places.formattedAddress,places.location,places.rating,places.priceLevel

{
  "textQuery": "pizza restaurants in New York",
  "languageCode": "en",
  "regionCode": "US",
  "maxResultCount": 5
}
```

**Результат:**
- **Status Code:** 403 (PERMISSION_DENIED)
- **Ответ:** 
```json
{
  "error": {
    "code": 403,
    "message": "Method doesn't allow unregistered callers (callers without established identity). Please use API Key or other form of API consumer identity to call this API.",
    "status": "PERMISSION_DENIED"
  }
}
```

#### 2. Тестирование различных типов запросов

Были протестированы следующие сценарии:

1. **Поиск ресторанов** - `"pizza restaurants in New York"`
2. **Поиск по адресу** - `"123 Main Street, New York"`
3. **Поиск по номеру телефона** - `"+1 212-555-0123"`
4. **Поиск с фильтрами** - кофейни с рейтингом выше 4.0, открытые сейчас

Все запросы вернули одинаковую ошибку 403, подтверждающую необходимость API ключа.

### Анализ результатов

#### Положительные аспекты:

1. **API работает корректно** - сервер отвечает быстро и возвращает структурированные ошибки
2. **Четкие сообщения об ошибках** - API ясно указывает на необходимость аутентификации
3. **Правильная структура запросов** - все тестовые запросы были сформированы корректно
4. **Соответствие документации** - поведение API полностью соответствует описанию в документации

#### Ключевые выводы:

1. **Обязательность API ключа** - без API ключа невозможно получить данные от API
2. **Структура запросов подтверждена** - формат POST запросов с JSON телом работает корректно
3. **Field Mask обязателен** - необходимо указывать поля для возврата через заголовок X-Goog-FieldMask
4. **Поддержка различных типов поиска** - API принимает разные форматы текстовых запросов

### Структура успешного ответа

На основе документации, успешный ответ должен иметь следующую структуру:

```json
{
  "places": [
    {
      "id": "ChIJN1t_tDeuEmsRUsoyG83frY4",
      "displayName": {
        "text": "Joe's Pizza",
        "languageCode": "en"
      },
      "formattedAddress": "123 Broadway, New York, NY 10001, USA",
      "location": {
        "latitude": 40.7589,
        "longitude": -73.9851
      },
      "rating": 4.2,
      "priceLevel": "PRICE_LEVEL_INEXPENSIVE"
    }
  ]
}
```

### Рекомендации по использованию

#### Для разработчиков:

1. **Получение API ключа:**
   - Создать проект в Google Cloud Console
   - Включить Places API (New)
   - Создать API ключ в разделе Credentials
   - Настроить ограничения для безопасности

2. **Структура запроса:**
   - Использовать POST метод
   - Обязательно указывать Content-Type: application/json
   - Добавлять API ключ в заголовок X-Goog-Api-Key
   - Указывать нужные поля в X-Goog-FieldMask

3. **Оптимизация затрат:**
   - Использовать минимальный набор полей в FieldMask
   - Выбирать подходящий уровень тарификации (Essentials/Pro/Enterprise)
   - Ограничивать количество результатов параметром maxResultCount

#### Примеры использования:

**Базовый поиск:**
```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -H "X-Goog-Api-Key: YOUR_API_KEY" \
  -H "X-Goog-FieldMask: places.displayName,places.formattedAddress" \
  -d '{"textQuery": "restaurants near me"}' \
  https://places.googleapis.com/v1/places:searchText
```

**Поиск с фильтрами:**
```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -H "X-Goog-Api-Key: YOUR_API_KEY" \
  -H "X-Goog-FieldMask: places.displayName,places.rating,places.priceLevel" \
  -d '{
    "textQuery": "italian restaurants",
    "regionCode": "US",
    "maxResultCount": 10,
    "minRating": 4.0,
    "openNow": true
  }' \
  https://places.googleapis.com/v1/places:searchText
```

### Ограничения и особенности

1. **Лимиты запросов:** Максимум 60 результатов на все страницы
2. **Обязательные параметры:** textQuery и FieldMask
3. **Тарификация:** Зависит от используемых полей в FieldMask
4. **Региональные ограничения:** Некоторые функции доступны не во всех регионах
5. **Требования к HTTPS:** Все запросы должны использовать HTTPS протокол


## Заключение

### Итоги исследования

В ходе исследования Google Maps Places API (New) была изучена полная документация, проанализированы возможности API и проведено практическое тестирование различных типов запросов.

#### Основные достижения:

1. **Полное изучение документации** - проанализированы все основные разделы официальной документации Google
2. **Понимание структуры API** - изучены форматы запросов, ответов и параметров
3. **Практическое тестирование** - созданы и выполнены тестовые запросы к API
4. **Анализ ответов** - исследованы различные типы ответов API, включая ошибки
5. **Создание примеров кода** - разработаны готовые к использованию примеры на Python

#### Ключевые выводы:

**Google Places API (New) представляет собой мощный инструмент для работы с данными о местах, который:**

- Предоставляет доступ к информации о более чем 200 миллионах мест по всему миру
- Поддерживает различные типы поиска: по тексту, адресу, номеру телефона
- Использует современную архитектуру REST API с JSON форматом данных
- Требует обязательной аутентификации через API ключ
- Предлагает гибкую систему тарификации в зависимости от используемых полей
- Обеспечивает высокую производительность и надежность

#### Практическая ценность:

API может быть эффективно использован для:
- Создания систем поиска мест и локаций
- Интеграции карт и геолокационных сервисов в приложения
- Разработки систем рекомендаций и обзоров
- Автоматизации процессов валидации адресов
- Создания туристических и навигационных приложений

#### Рекомендации для внедрения:

1. **Планирование проекта:**
   - Определить необходимые поля данных для оптимизации затрат
   - Выбрать подходящий уровень тарификации
   - Спланировать архитектуру для эффективного использования API

2. **Техническая реализация:**
   - Использовать готовые примеры кода из данного исследования
   - Реализовать обработку ошибок и повторные попытки
   - Настроить кэширование для снижения количества запросов

3. **Безопасность:**
   - Правильно настроить ограничения API ключа
   - Использовать переменные окружения для хранения ключей
   - Регулярно мониторить использование API

### Дальнейшие шаги

Для полноценного использования API рекомендуется:

1. Создать проект в Google Cloud Console
2. Настроить биллинговый аккаунт
3. Получить API ключ и настроить ограничения
4. Протестировать API с реальным ключом
5. Интегрировать API в целевое приложение

### Полезные ресурсы

- **Официальная документация:** https://developers.google.com/maps/documentation/places/web-service
- **Google Cloud Console:** https://console.cloud.google.com/
- **Примеры кода:** Файлы test_places_api.py и extended_places_test.py в данном проекте
- **Поддержка:** Google Maps Platform Support

---

*Исследование выполнено: 14 июня 2025 года*  
*Версия API: Places API (New) v1*  
*Статус: Завершено*

